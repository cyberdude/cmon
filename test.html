<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <link rel="dns-prefetch" href="//airve.com">
    <title>cmon: test suite</title>
    <meta name=viewport content="width=device-width,initial-scale=1.0">
    <meta name=description content="JavaScript test suite for cmon.js">
    <meta name=author content="Ryan Van Etten">
    <style>
        html { font-family:sans-serif; background:#fffddd; color:#222; }
        body { width:96%; margin:auto; }
    </style>
</head>
<body>

<h1>
    <a href="http://github.com/ryanve/cmon">cmon</a>: test suite
</h1>

<main id="main" role="main">
    <p>Open the console to view results.</p>
    <p>View the pagesource to view tests.</p>
</main>

<!-- airve.github.io -->
<script src="../aok/aok.min.js"></script>
<script src="../elo/elo.min.js"></script>
<script src="cmon.js"></script>
<script>
    (function(root) {
        var cmon = root.cmon
          , aok = root.aok
          , provide = cmon.provide
          , require = cmon.require
          , port = {};
        
        function handler() {
            handler.ran++;
            handler.scope = this;
        }

        handler.reset = function(to) {
            handler.ran = to || 0;
            return handler;
        }; 
        
        handler.did = function() {
            return handler.ran;
        };
        
        handler.didnt = function() {
            return !handler.ran;
        };

        (function(name) {
            var count = provide.on(name, handler);
            aok({id:'onLength', test:1 === count});
            handler.reset();
            provide(name, port);
            aok({id:name, test:handler.did});

            // remove all and remember length
            count = provide.off(name, handler);
            aok({
                id:'offLength'
              , test:function() {
                    return isFinite(this.remark = count);
                }
            });

            // ensure the handler was removed
            handler.reset();
            provide(name, port);
            aok({id:'offSingle', test:handler.didnt});
            handler.reset();
        }('onHandles'));

    }(this));
</script>
</body>
</html>